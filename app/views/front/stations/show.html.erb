<style type="text/css">
  #allmap{float:left;}
  #r-result{height:400px;width:30%;float:left;overflow: scroll;}
</style>

<div class="row">
  <% if @station.pictures.present? %>
  <div class="col-sm-6">
    <div id="carousel-station" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <% @station.pictures.each_with_index do |p, index| %>
        <li data-target="#carousel-station" data-slide-to="<%= index %>" class="<%= 'active' if index == 0%>"></li>
        <% end %>
      </ol>
      <div class="carousel-inner">
        <% active_flag = true %>
        <% @station.pictures.each do |p| %>
          <% if active_flag %>
            <div class="item active">
            <% active_flag = false %>
          <% else %>
            <div class="item">
          <% end %>
            <%= image_tag p.data.url(:medium), class: "station-pictures"%>
            <!--
            <div class="carousel-caption">
              First Slide
            </div>
            -->
          </div>
        <% end %>
      </div>
      <a class="left carousel-control" href="#carousel-station" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
      </a>
      <a class="right carousel-control" href="#carousel-station" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
      </a>
    </div>
  </div>
  <% end %>

  <div class="col-sm-6">
    <h3><%= @station.name %></h3>
    <hr>
    <p>详细地址：<%= @station.address_text %>&nbsp;&nbsp;&nbsp;&nbsp;[<a href="#station_map"><%= t('view.label.map')%></a>]</p>
    <p>联系电话：<%= @station.telephone %></p>
    <br>
    <div class='action'>
      <%= link_to t("view.action.order_online"), new_front_station_order_path(@station), class: "btn btn-danger btn-lg" %>
    </div>
  </div>
</div>
<hr>
<div class="row station-area-for-show">
  <div class="title">
    <h4>车检站简介</h4>
  </div>
  <div class="recommend">
    <%= @station.recommend.present? ? @station.recommend : '暂无' %></p>
  </div>
</div>

<% if @station.has_map_info? %>
<div class="row station-area-for-show" id="station_map">
  <div class="title">
    <div class="pull-right" style="margin-top: 3px;">
      <button id="refresh_map" class="btn btn-warning">
        <i class="fa fa-refresh"></i> 重置
      </button>
    </div>
    <h4>车检站地图&nbsp;&nbsp;<small style="color: white;">[<%= @station.address_text %>]</small></h4>
  </div>
  <div class="recommend col-sm-12">
    <div id="allmap" style="width: 68%; height:400px;"></div>
    <div id="r-result"></div>
  </div>
</div>

<div id="stationMapWindow" style="display: none;">
  <div style="margin:0;line-height:20px;padding:2px;">
    <%= image_tag @station.logo.url(:thumb), style: "float:right;zoom:1;overflow:hidden;width:90px;height:60px;margin-left:3px;"  %>
    地址：<%= @station.address_text%>
    <br/>
    电话：<%= @station.telephone %>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function(){
  function initMap() {
    // 创建Map实例
    var map = new BMap.Map("allmap", {minZoom:10,maxZoom:16});
    //添加默认缩放平移控件
    map.addControl(new BMap.NavigationControl());
    //启用滚轮放大缩小
    map.enableScrollWheelZoom();
    // 创建点坐标
    var point = new BMap.Point(<%= @station.jingdu%>, <%= @station.weidu%>);
    map.addOverlay(new BMap.Marker(point));
    // 初始化地图,设置中心点坐标和地图级别。
    map.centerAndZoom(point,15);

    var content = $("#stationMapWindow").html();

    //创建检索信息窗口对象
    var searchInfoWindow = null;
    searchInfoWindow = new BMapLib.SearchInfoWindow(map, content, {
      title  : "<%= @station.name %>",      //标题
      width  : 290,             //宽度
      height : 105,              //高度
      panel  : "r-result",         //检索结果面板
      enableAutoPan : true,     //自动平移
      searchTypes   :[
        BMAPLIB_TAB_SEARCH,   //周边检索
        BMAPLIB_TAB_TO_HERE,  //到这里去
        BMAPLIB_TAB_FROM_HERE //从这里出发
      ]
    });
    var marker = new BMap.Marker(point); //创建marker对象
    marker.enableDragging(); //marker可拖拽
    marker.addEventListener("click", function(e){
      searchInfoWindow.open(marker);
    })
    map.addOverlay(marker); //在地图中添加marker
    searchInfoWindow.open(marker); //在marker上打开检索信息串口
  };


  $("#refresh_map").click(function(){
    initMap();
  });
  initMap();

});
</script>

<%= render "common/baidu_map/script_link"%>
<%= javascript_include_tag 'baidu_map/SearchInfoWindow', 'data-turbolinks-track' => false %>
<% end%>
